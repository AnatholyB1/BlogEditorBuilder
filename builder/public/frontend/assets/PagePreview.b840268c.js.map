{"version":3,"file":"PagePreview.b840268c.js","sources":["../../../../frontend/src/pages/PagePreview.vue"],"sourcesContent":["<template>\n\t<div class=\"flex h-screen flex-col items-center bg-gray-100 p-5 dark:bg-zinc-900\">\n\t\t<div class=\"relative flex w-full items-center justify-center\">\n\t\t\t<router-link\n\t\t\t\t:to=\"{ name: 'builder', params: { pageId: route.params.pageId || 'new' } }\"\n\t\t\t\tclass=\"absolute left-5 flex w-fit text-sm text-gray-600 hover:text-gray-900 dark:text-gray-400 hover:dark:text-gray-100\">\n\t\t\t\t<FeatherIcon name=\"arrow-left\" class=\"mr-4 h-4 w-4 cursor-pointer\" />\n\t\t\t\tBack to builder\n\t\t\t</router-link>\n\t\t\t<div class=\"flex gap-1 text-gray-500 dark:bg-zinc-900 dark:text-zinc-500\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"w-auto cursor-pointer rounded-md p-1 px-[8px]\"\n\t\t\t\t\tv-for=\"breakpoint in deviceBreakpoints\"\n\t\t\t\t\t:key=\"breakpoint.device\"\n\t\t\t\t\t:class=\"{\n\t\t\t\t\t\t'bg-white shadow-sm dark:bg-zinc-700': activeBreakpoint === breakpoint.device,\n\t\t\t\t\t}\"\n\t\t\t\t\t@click.stop=\"() => setWidth(breakpoint.device)\">\n\t\t\t\t\t<FeatherIcon\n\t\t\t\t\t\t:name=\"breakpoint.icon\"\n\t\t\t\t\t\tclass=\"h-6 w-5\"\n\t\t\t\t\t\t:class=\"{\n\t\t\t\t\t\t\t'text-gray-700   dark:text-zinc-50': activeBreakpoint === breakpoint.device,\n\t\t\t\t\t\t}\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<Button\n\t\t\t\tvariant=\"solid\"\n\t\t\t\t@click=\"\n\t\t\t\t\t() => {\n\t\t\t\t\t\tpublishing = true;\n\t\t\t\t\t\tstore.publishPage().finally(() => (publishing = false));\n\t\t\t\t\t}\n\t\t\t\t\"\n\t\t\t\tclass=\"absolute right-0 border-0 text-xs dark:bg-zinc-800\"\n\t\t\t\t:loading=\"publishing\">\n\t\t\t\t{{ publishing ? \"Publishing\" : \"Publish\" }}\n\t\t\t</Button>\n\t\t</div>\n\t\t<div\n\t\t\tclass=\"relative mt-5 flex h-[85vh] bg-white\"\n\t\t\t:style=\"{\n\t\t\t\twidth: width + 'px',\n\t\t\t}\">\n\t\t\t<PanelResizer\n\t\t\t\tclass=\"ml-[-12px]\"\n\t\t\t\tside=\"left\"\n\t\t\t\t:dimension=\"width\"\n\t\t\t\t:minDimension=\"minWidth\"\n\t\t\t\t:maxDimension=\"maxWidth\"\n\t\t\t\t:resizeSensitivity=\"2\"\n\t\t\t\t@resize=\"(val) => (width = val)\">\n\t\t\t\t<div class=\"resize-handler-left h-full w-2 rounded-sm bg-gray-200 dark:bg-zinc-600\"></div>\n\t\t\t</PanelResizer>\n\t\t\t<iframe\n\t\t\t\t:src=\"previewRoute\"\n\t\t\t\tframeborder=\"0\"\n\t\t\t\tv-if=\"previewRoute\"\n\t\t\t\tclass=\"flex-1 rounded-sm\"\n\t\t\t\tref=\"previewWindow\"></iframe>\n\t\t\t<div\n\t\t\t\tv-if=\"loading\"\n\t\t\t\tclass=\"absolute flex h-full w-full flex-1 items-center justify-center bg-white bg-opacity-50 text-gray-600\">\n\t\t\t\tLoading...\n\t\t\t</div>\n\t\t\t<PanelResizer\n\t\t\t\tclass=\"mr-[-8px]\"\n\t\t\t\tside=\"right\"\n\t\t\t\t:dimension=\"width\"\n\t\t\t\t:minDimension=\"minWidth\"\n\t\t\t\t:maxDimension=\"maxWidth\"\n\t\t\t\t:resizeSensitivity=\"2\"\n\t\t\t\t@resize=\"(val) => (width = val)\">\n\t\t\t\t<div class=\"resize-handler-left h-full w-2 rounded-sm bg-gray-200 dark:bg-zinc-600\"></div>\n\t\t\t</PanelResizer>\n\t\t</div>\n\t</div>\n</template>\n<script lang=\"ts\" setup>\nimport PanelResizer from \"@/components/PanelResizer.vue\";\nimport router from \"@/router\";\nimport useStore from \"@/store\";\nimport { useEventListener } from \"@vueuse/core\";\nimport { Ref, computed, ref, watch, watchEffect } from \"vue\";\nimport { useRoute } from \"vue-router\";\n\nconst route = useRoute();\nconst maxWidth = window.innerWidth * 0.92;\nconst minWidth = 400;\nlet previewRoute = ref(\"\");\nconst width = ref(maxWidth);\nconst loading = ref(false);\nconst store = useStore();\nconst publishing = ref(false);\nconst { deviceBreakpoints } = store;\nconst activeBreakpoint = computed(() => {\n\tconst tabletBreakpoint = deviceBreakpoints.find((b) => b.device === \"tablet\");\n\tconst mobileBreakpoint = deviceBreakpoints.find((b) => b.device === \"mobile\");\n\tif (width.value <= (mobileBreakpoint?.width || minWidth)) {\n\t\treturn \"mobile\";\n\t}\n\tif (width.value <= (tabletBreakpoint?.width || maxWidth)) {\n\t\treturn \"tablet\";\n\t}\n\treturn \"desktop\";\n});\n\nconst previewWindow = ref(null) as Ref<HTMLIFrameElement | null>;\n\nuseEventListener(document, \"keydown\", (ev) => {\n\tif (ev.key === \"Escape\" && router.currentRoute.value.name === \"preview\") {\n\t\thistory.back();\n\t}\n});\n\n// hack to relay mouseup event from iframe to parent\nwatchEffect(() => {\n\tif (previewWindow.value) {\n\t\tloading.value = true;\n\t\tpreviewWindow.value.addEventListener(\"load\", () => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tloading.value = false;\n\t\t\t}, 100);\n\t\t\tpreviewWindow.value?.addEventListener(\"mousedown\", (ev) => {\n\t\t\t\tdocument.dispatchEvent(new MouseEvent(\"mousedown\", ev));\n\t\t\t});\n\t\t\tpreviewWindow.value?.contentWindow?.document.addEventListener(\"mouseup\", (ev) => {\n\t\t\t\tdocument.dispatchEvent(new MouseEvent(\"mouseup\", ev));\n\t\t\t});\n\t\t});\n\t}\n});\n\nconst setWidth = (device: string) => {\n\tconst breakpoint = deviceBreakpoints.find((b) => b.device === device);\n\tif (breakpoint) {\n\t\tif (breakpoint.device === \"desktop\") {\n\t\t\twidth.value = maxWidth;\n\t\t} else {\n\t\t\twidth.value = breakpoint.width;\n\t\t}\n\t}\n};\n\nconst setPreviewURL = () => {\n\tlet queryParams = {\n\t\tpage: route.params.pageId,\n\t\t...store.routeVariables,\n\t};\n\tpreviewRoute.value = `/api/method/builder.builder.doctype.builder_page.builder_page.get_page_preview_html?${Object.entries(\n\t\tqueryParams\n\t)\n\t\t.map(([key, value]) => `${key}=${value}`)\n\t\t.join(\"&\")}`;\n};\n\nwatch(\n\t() => route.params.pageId,\n\t() => {\n\t\tsetPreviewURL();\n\t},\n\t{ immediate: true }\n);\n</script>\n"],"names":["minWidth","route","useRoute","maxWidth","previewRoute","ref","width","loading","store","useStore","publishing","deviceBreakpoints","activeBreakpoint","computed","tabletBreakpoint","b","mobileBreakpoint","previewWindow","useEventListener","ev","router","watchEffect","_a","_c","_b","setWidth","device","breakpoint","setPreviewURL","queryParams","__spreadValues","key","value","watch"],"mappings":"uvCAwFMA,EAAW,wCAFjB,MAAMC,EAAQC,IACRC,EAAW,OAAO,WAAa,IAEjC,IAAAC,EAAeC,EAAI,EAAE,EACnB,MAAAC,EAAQD,EAAIF,CAAQ,EACpBI,EAAUF,EAAI,EAAK,EACnBG,EAAQC,IACRC,EAAaL,EAAI,EAAK,EACtB,CAAE,kBAAAM,CAAsB,EAAAH,EACxBI,EAAmBC,EAAS,IAAM,CACvC,MAAMC,EAAmBH,EAAkB,KAAMI,GAAMA,EAAE,SAAW,QAAQ,EACtEC,EAAmBL,EAAkB,KAAMI,GAAMA,EAAE,SAAW,QAAQ,EAC5E,OAAIT,EAAM,SAAUU,GAAA,YAAAA,EAAkB,QAAShB,GACvC,SAEJM,EAAM,SAAUQ,GAAA,YAAAA,EAAkB,QAASX,GACvC,SAED,SAAA,CACP,EAEKc,EAAgBZ,EAAI,IAAI,EAEba,EAAA,SAAU,UAAYC,GAAO,CACzCA,EAAG,MAAQ,UAAYC,EAAO,aAAa,MAAM,OAAS,WAC7D,QAAQ,KAAK,CACd,CACA,EAGDC,EAAY,IAAM,CACbJ,EAAc,QACjBV,EAAQ,MAAQ,GACFU,EAAA,MAAM,iBAAiB,OAAQ,IAAM,WAClD,WAAW,IAAM,CAChBV,EAAQ,MAAQ,IACd,GAAG,GACNe,EAAAL,EAAc,QAAd,MAAAK,EAAqB,iBAAiB,YAAcH,GAAO,CAC1D,SAAS,cAAc,IAAI,WAAW,YAAaA,CAAE,CAAC,CAAA,IAEvDI,GAAAC,EAAAP,EAAc,QAAd,YAAAO,EAAqB,gBAArB,MAAAD,EAAoC,SAAS,iBAAiB,UAAYJ,GAAO,CAChF,SAAS,cAAc,IAAI,WAAW,UAAWA,CAAE,CAAC,CAAA,EACpD,CACD,EACF,CACA,EAEK,MAAAM,EAAYC,GAAmB,CACpC,MAAMC,EAAahB,EAAkB,KAAMI,GAAMA,EAAE,SAAWW,CAAM,EAChEC,IACCA,EAAW,SAAW,UACzBrB,EAAM,MAAQH,EAEdG,EAAM,MAAQqB,EAAW,MAE3B,EAGKC,EAAgB,IAAM,CAC3B,IAAIC,EAAcC,EAAA,CACjB,KAAM7B,EAAM,OAAO,QAChBO,EAAM,gBAEGJ,EAAA,MAAQ,uFAAuF,OAAO,QAClHyB,CAEC,EAAA,IAAI,CAAC,CAACE,EAAKC,CAAK,IAAM,GAAGD,KAAOC,GAAO,EACvC,KAAK,GAAG,GAAA,EAGX,OAAAC,EACC,IAAMhC,EAAM,OAAO,OACnB,IAAM,CACS2B,GACf,EACA,CAAE,UAAW,EAAK,CAAA"}